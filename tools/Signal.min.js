define(["require","exports","tools/SignalBinding"],function(n,t,i){var r=i,u=function(){function n(){this._bindings=[],this._prevParams=null,this.memorize=!1,this._shouldPropagate=!0,this.active=!0}return n.VERSION="1.0.0",n.prototype.validateListener=function(n,t){if(typeof n!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t));},n.prototype._registerListener=function(n,t,i,u){var e=this._indexOfListener(n,i),f;if(e!==-1){if(f=this._bindings[e],f.isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.");}else f=new r.SignalBinding(this,n,t,i,u),this._addBinding(f);return this.memorize&&this._prevParams&&f.execute(this._prevParams),f},n.prototype._addBinding=function(n){var t=this._bindings.length;do--t;while(this._bindings[t]&&n.priority<=this._bindings[t].priority);this._bindings.splice(t+1,0,n)},n.prototype._indexOfListener=function(n,t){for(var i=this._bindings.length,r;i--;)if(r=this._bindings[i],r.getListener()===n&&r.context===t)return i;return-1},n.prototype.has=function(n,t){return typeof t=="undefined"&&(t=null),this._indexOfListener(n,t)!==-1},n.prototype.add=function(n,t,i){return typeof t=="undefined"&&(t=null),typeof i=="undefined"&&(i=0),this.validateListener(n,"add"),this._registerListener(n,!1,t,i)},n.prototype.addOnce=function(n,t,i){return typeof t=="undefined"&&(t=null),typeof i=="undefined"&&(i=0),this.validateListener(n,"addOnce"),this._registerListener(n,!0,t,i)},n.prototype.remove=function(n,t){typeof t=="undefined"&&(t=null),this.validateListener(n,"remove");var i=this._indexOfListener(n,t);return i!==-1&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),n},n.prototype.removeAll=function(){for(var n=this._bindings.length;n--;)this._bindings[n]._destroy();this._bindings.length=0},n.prototype.getNumListeners=function(){return this._bindings.length},n.prototype.halt=function(){this._shouldPropagate=!1},n.prototype.dispatch=function(){for(var i=[],t,r,n=0;n<arguments.length-0;n++)i[n]=arguments[n+0];if(this.active&&(t=this._bindings.length,this.memorize&&(this._prevParams=i),t)){r=this._bindings.slice(0),this._shouldPropagate=!0;do t--;while(r[t]&&this._shouldPropagate&&r[t].execute(i)!==!1)}},n.prototype.forget=function(){this._prevParams=null},n.prototype.dispose=function(){this.removeAll(),delete this._bindings,delete this._prevParams},n.prototype.toString=function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"},n}();t.Signal=u})