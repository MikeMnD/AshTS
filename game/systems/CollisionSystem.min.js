define("game/systems/collisionsystem",["ash/system","game/nodes/spaceshipcollision","game/nodes/asteroidcollision","game/nodes/bulletcollision"],function(n,t,i,r){function f(t){Object.extend(f.prototype,n.prototype),this.initialise(t)}var u=f.prototype;return u.creator=null,u.spaceships=null,u.asteroids=null,u.bullets=null,u.initialise=function(n){return this.creator=n,this},u.addToEngine=function(n){this.spaceships=n.getNodeList(t),this.asteroids=n.getNodeList(i),this.bullets=n.getNodeList(r)},u.removeFromEngine=function(){this.spaceships=null,this.asteroids=null,this.bullets=null},u.update=function(){for(var n,t,r,i=this.bullets.head;i;i=i.next)for(n=this.asteroids.head;n;n=n.next)if(n.position.position.distanceTo(i.position.position)<=n.position.collisionRadius){if(this.creator.destroyEntity(i.entity),n.position.collisionRadius>20)for(r=0;r<8;r+=1)this.creator.createAsteroid(n.position.collisionRadius-10,n.position.position.x+Math.random()*10-5,n.position.position.y+Math.random()*10-5);if(n.position.collisionRadius>10)for(r=0;r<2;r+=1)this.creator.createAsteroid(n.position.collisionRadius-10,n.position.position.x+Math.random()*10-5,n.position.position.y+Math.random()*10-5);this.creator.destroyEntity(n.entity);break}for(t=this.spaceships.head;t;t=t.next)for(n=this.asteroids.head;n;n=n.next)if(n.position.position.distanceTo(t.position.position)<=n.position.collisionRadius+t.position.collisionRadius){this.creator.destroyEntity(t.entity);break}},f})