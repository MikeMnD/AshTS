define("game/systems/movementsystem",["ash/system","game/nodes/movement"],function(n,t){function r(t){Object.extend(r.prototype,n.prototype),this.initialise(t)}var i=r.prototype;return i.gameState=null,i.nodeList=null,i.initialise=function(n){return this.gameState=n,this},i.addToEngine=function(n){this.nodeList=n.getNodeList(t)},i.removeFromEngine=function(){this.nodeList=null},i.update=function(n){for(var t=this.nodeList.head;t;t=t.next)this.updateNode(t,n)},i.updateNode=function(n,t){var r=n.position,i=n.motion,u,f;r.position.x+=i.velocity.x*t,r.position.y+=i.velocity.y*t,r.position.x<0&&(r.position.x+=this.gameState.width),r.position.x>this.gameState.width&&(r.position.x-=this.gameState.width),r.position.y<0&&(r.position.y+=this.gameState.height),r.position.y>this.gameState.height&&(r.position.y-=this.gameState.height),r.rotation+=i.angularVelocity*t,i.damping>0&&(u=Math.abs(Math.cos(r.rotation)*i.damping*t),f=Math.abs(Math.sin(r.rotation)*i.damping*t),i.velocity.x>u?i.velocity.x-=u:i.velocity.x<-u?i.velocity.x+=u:i.velocity.x=0,i.velocity.y>f?i.velocity.y-=f:i.velocity.y<-f?i.velocity.y+=f:i.velocity.y=0)},r})